# 施設運営「キッチンカー」報告書作成システム

## 目次

1. [概要](#概要)  
2. [目的](#目的)  
3. [主な機能](#主な機能)  
4. [設定](#設定)  
5. [主な関数](#主な関数)  
6. [ファイル構成](#ファイル構成)

---

## 概要

このスクリプトは、Googleフォームから送信された回答を基に、キッチンカー利用報告書を自動作成・提出するためのシステムである。生成された報告書はGoogleドキュメントとして保存され、PDFに変換後、学校担当者および関係者にメールで送信される。

<p align="right">(<a href="#top">トップへ</a>)</p>
---

## 目的

1. キッチンカー利用後の報告業務を効率化し、書類作成にかかる時間を短縮する。  
2. 学校側およびサークル代表者への適切な情報共有を実現する。  
3. 報告書作成プロセスを自動化し、ミスや手間を減らす。  

---

## 主な機能

1. **報告書の自動生成**  
   - フォーム回答を基に、テンプレートを用いて報告書を生成する。  
   - 必要な項目（開始日、終了日、結果など）を自動的に埋め込む。

2. **Googleドライブでのファイル管理**  
   - 生成されたドキュメントとPDFを新しいフォルダに移動。  
   - フォルダ名は「サークル名_終了日」の形式で作成される。

3. **PDF変換とメール送信**  
   - 報告書をPDFに変換し、学校担当者および関係者に送信する。  
   - メールには作成されたPDFを添付し、必要な情報を含める。

<p align="right">(<a href="#top">トップへ</a>)</p>
---

## 設定

### 必要な環境

1. **Googleフォーム**  
   - 申請データを取得するためのフォーム。

2. **Googleドキュメントテンプレート**  
   - 報告書のテンプレート。スクリプトで指定したIDを用いる。  

3. **Googleドライブ**  
   - 報告書やPDFを保存するフォルダを管理。親フォルダIDを設定する必要がある。

### 設定箇所

1. **テンプレートドキュメントのID**
   ```javascript
   const templateDocId = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';
   ```

2. **親フォルダのID**
   ```javascript
   const parentFolderId = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';
   ```

3. **送信先メールアドレス**
   ```javascript
   to: 'school@example';
   ```

<p align="right">(<a href="#top">トップへ</a>)</p>
---

## 主な関数

### 1. `onFormSubmit(e)`
- **目的**: Googleフォームの送信をトリガーとして、報告書を作成・提出する。
- **処理概要**:  
  1. フォーム回答データを取得し、各項目を変数に格納。  
  2. テンプレートドキュメントをコピーし、フォーム回答を埋め込む形で編集。  
  3. 編集後のドキュメントをPDFに変換。  
  4. 新しいフォルダを作成してファイルを移動。  
  5. メールでPDFを送信。


### 2. `MailApp.sendEmail(options)`
- **目的**: 報告書を関係者にメールで送信する。
- **処理概要**:  
  1. 件名、本文、添付ファイルを指定。  
  2. 学校担当者とサークル代表者を含むメールを送信。  


### 3. `DriveApp.getFileById(fileId)`
- **目的**: 指定されたIDのファイルを取得する。
- **処理概要**:  
  - テンプレートドキュメントを取得し、コピーを作成する。  


### 4. `DriveApp.createFolder(folderName)`
- **目的**: Googleドライブ内に新しいフォルダを作成する。
- **処理概要**:  
  - 親フォルダ内に「サークル名_終了日」という名前のフォルダを作成。  


### 5. `Utilities.sleep(milliseconds)`
- **目的**: 処理間に一時停止を挟む。
- **処理概要**:  
  - ドキュメントやファイルの生成が完了するまで待機する。  

<p align="right">(<a href="#top">トップへ</a>)</p>
---

## ファイル構成

.

├── report_README.md                              # 本ファイル

├── [report.js](report.js)     # コード

├── [report_docs.pdf](report_form.pdf)   # テンプレートドキュメント

└── [report_form.xlsx](report_form.xlsx)  # フォームの内容を反映させたスプレッドシート(出力の関係でExcelファイルになっている。本来はスプレッドシートのデータ)

<p align="right">(<a href="#top">トップへ</a>)</p>
