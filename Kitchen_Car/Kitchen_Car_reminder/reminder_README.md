# 施設運営「キッチンカー」リマインドシステム

## 目次
1. [概要](#概要)
2. [目的](#目的)
3. [主な機能](#主な機能)
4. [設定](#設定)
5. [スクリプトの主な関数](#スクリプトの主な機能)
6. [ファイル構成](#ファイル構成)
7. [イメージ](#イメージ)

---

## 概要

Googleスプレッドシート上のデータを基にSlack通知やメール通知を自動化するリマインダーである。利用日の2日前、一週間前、終了日のいずれかに適切な通知を行うことで、関係者の確認や準備の負担を軽減する。

[申込書作成](/Kitchen_Car/Kitchen_Car_application/application_README.md)のときに収集したデータをリマインド用のスクリプトに移して処理している。


<p align="right">(<a href="#top">トップへ</a>)</p>

---

## 目的
このシステムの目的は以下である。
- イベントに関する重要な日程を関係者にリマインドする。
- Slackおよびメールを利用して効率的に通知を送信する。
- Googleスプレッドシートを用いて情報を一元管理し、タスクの漏れを防止する。


<p align="right">(<a href="#top">トップへ</a>)</p>

---

## 主な機能

### 1. **Slack通知**
- キッチンカー利用の「2日前」と「1週間前」にSlackへ通知を送信。
- 通知内容には、クラブサークル名、利用日程、スケジュール調整リンクが含まれる。

### 2. **メール通知**
- 対象クラブサークルの代表者に対し、リマインドメールを自動送信します。- キッチンカー利用の「2日前」と「1週間前」に通知。

### 3. **フォーム記入依頼**
- イベント終了後、学校提出用のドキュメント作成を目的としたGoogleフォームへの記入を促す。報告書作成に関しては[こちら](/Kitchen_Car/Kitchen_Car_report/report_README.md)
- 記入後に自動でドキュメントが生成され、報告が簡単に行える仕組みを提供。


<p align="right">(<a href="#top">トップへ</a>)</p>
---

## 設定

1. **Googleスプレッドシート**
   - クラブサークル情報およびスケジュールを記録するスプレッドシートを作成。
   - シート名: `シート1`

2. **Slack Webhook URL**
   - SlackのWebhook URLを設定し、通知を送信するチャンネルを指定。
   ```javascript
   var slackWebhookUrl = "https://hooks.slack.com/services/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";

   ```

3. **トリガー設定**
   - `postToSlack`関数: 毎日定期的に実行するようトリガーを設定。
   - `endEmail`関数: 毎日実行して終了日のチェックを行う。

4. **Googleフォーム**
   - 結果報告用のGoogleフォームを作成し、そのリンクをスクリプトに設定。


<p align="right">(<a href="#top">トップへ</a>)</p>
---

## スクリプトの主な関数

### 1. `postToSlack`
- **目的**: スプレッドシートのデータを基に、リマインド通知をSlackに投稿する。  
- **処理概要**:  
  1. スプレッドシートからデータを取得。  
  2. イベントの日付と現在の日付を比較し、該当するリマインド通知を作成。  
  3. Slackに一括通知を投稿する。

### 2. `endEmail`
- **目的**: イベント終了日に、フォーム記入依頼をサークル代表者に送信する。  
- **処理概要**:  
  1. スプレッドシートから終了日情報を取得。  
  2. 現在の日付と一致する終了日がある場合、メールを送信する。  

### 3. `sendFormEmail`
- **目的**: 結果報告フォームの記入依頼メールを送信する。  
- **処理概要**:  
  1. フォームリンクやサークル名を含むメール内容を生成。  
  2. プレーンテキストとHTML形式でメールを送信。  

### 4. `areDatesEqual`
- **目的**: 2つの日付が一致するかを比較する。  
- **処理概要**:  
  - `toDateString` を用いて比較し、真偽値を返す。

### 5. `postMessageToSlack`
- **目的**: Slack Webhookを用いてメッセージを投稿する。  
- **処理概要**:  
  1. Slack API用のペイロードを構築。  
  2. `UrlFetchApp.fetch` を利用してメッセージを送信。

### 6. `sendReminderEmail`
- **目的**: リマインド通知メールを送信する。  
- **処理概要**:  
  1. サークル名や担当者名を含むカスタマイズされたメール内容を生成。  
  2. メール本文をプレーンテキストとHTML形式で作成し、送信。


<p align="right">(<a href="#top">トップへ</a>)</p>
---

## ファイル構成

.

├── reminder_README.md                              # 本ファイル

├── [reminder.js](reminder.js)     # コード

└── [reminder_form.xlsx](reminder_form.xlsx)  # フォームの内容を反映させたスプレッドシート(出力の関係でExcelファイルになっている。本来はスプレッドシートのデータ)


<p align="right">(<a href="#top">トップへ</a>)</p>

---

## イメージ

- **Slack通知イメージ**: 準備中
- **デモ動画**: 準備中

---

<p align="right">(<a href="#top">トップへ</a>)</p>
